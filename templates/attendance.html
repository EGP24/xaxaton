<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Отметка посещаемости</title>
    <link rel="stylesheet" href="/static/global.css">
    <style>
        body {
            margin: 0;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        .wrapper {
            max-width: 960px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }
        header {
            margin-bottom: var(--spacing-lg);
        }
        header h1 {
            margin: 0 0 var(--spacing-xs) 0;
            font-family: var(--font-family-mono);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: var(--font-weight-bold);
        }
        .meta-card {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            border: 1px solid var(--border-color);
            margin-bottom: var(--spacing-lg);
        }
        .meta-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }
        .meta-item span {
            display: block;
            color: var(--text-secondary);
            font-size: var(--font-size-xs);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: var(--font-weight-semibold);
        }
        .meta-item strong {
            font-size: var(--font-size-lg);
            font-family: var(--font-family-mono);
            font-weight: var(--font-weight-bold);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        th, td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            font-size: var(--font-size-sm);
        }
        th {
            background: var(--gray-100);
            text-align: left;
            color: var(--text-secondary);
            font-weight: var(--font-weight-bold);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        tr:last-child td {
            border-bottom: none;
        }
        .status-buttons {
            display: flex;
            gap: var(--spacing-xs);
        }
        .status-btn {
            border: 1px solid var(--border-color-dark);
            border-radius: var(--border-radius);
            padding: 6px 12px;
            font-size: var(--font-size-sm);
            cursor: pointer;
            font-weight: var(--font-weight-semibold);
            transition: all 100ms ease;
        }
        .status-present {
            background: var(--success-light);
            color: var(--success);
            border-color: var(--success);
        }
        .status-absent {
            background: var(--error-light);
            color: var(--error);
            border-color: var(--error);
        }
        .status-excused {
            background: var(--warning-light);
            color: var(--warning);
            border-color: var(--warning);
        }
        .status-btn.active {
            border-width: 2px;
        }
        .btn {
            border: 1px solid var(--border-color-dark);
            border-radius: var(--border-radius);
            padding: 8px 16px;
            cursor: pointer;
            font-weight: var(--font-weight-semibold);
            transition: all 100ms ease;
            font-size: var(--font-size-base);
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        .btn-muted {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border-color-dark);
        }
        .btn-muted:hover {
            background: var(--gray-200);
        }
        .grade-input {
            width: 80px;
            padding: 6px;
            border: 1px solid var(--border-color-dark);
            border-radius: var(--border-radius);
            text-align: center;
            font-family: var(--font-family-mono);
            font-weight: var(--font-weight-bold);
        }
        .actions {
            margin-top: var(--spacing-lg);
            display: flex;
            gap: var(--spacing-md);
        }
        .badge {
            padding: 4px 12px;
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            background: var(--info-light);
            color: var(--info);
            border: 1px solid var(--info);
            font-weight: var(--font-weight-semibold);
        }
        .photo-upload-section {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            border: 1px solid var(--border-color);
            margin-bottom: var(--spacing-lg);
        }
        .photo-upload-area {
            border: 2px dashed var(--border-color-dark);
            border-radius: var(--border-radius);
            padding: var(--spacing-2xl);
            text-align: center;
            cursor: pointer;
            transition: all 100ms ease;
            background: var(--bg-tertiary);
        }
        .photo-upload-area:hover {
            border-color: var(--primary);
            background: var(--bg-secondary);
        }
        .photo-upload-area.dragging {
            border-color: var(--primary);
            background: var(--info-light);
        }
        .photo-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--border-radius);
            margin-top: var(--spacing-md);
            display: none;
            border: 1px solid var(--border-color);
        }
        .photo-preview.show {
            display: block;
        }
        .recognition-stats {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--success-light);
            border-radius: var(--border-radius);
            border: 1px solid var(--success);
            display: none;
            color: var(--success);
            font-weight: var(--font-weight-semibold);
        }
        .recognition-stats.show {
            display: block;
        }
        .ai-status-indicator {
            display: inline-block;
            margin-left: var(--spacing-xs);
            font-size: var(--font-size-base);
        }
        .status-auto-detected {
            position: relative;
        }
        .status-btn.active:has(+ .status-auto-detected) {
            background: linear-gradient(135deg, var(--success) 0%, #10b981 100%);
        }
        @media (max-width: 640px) {
            .status-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <header>
            <button class="btn btn-muted" onclick="history.back()" style="margin-bottom:var(--spacing-md);">Назад</button>
            <h1>Посещаемость</h1>
            <p id="teacherName" style="color:var(--text-secondary);">Загрузка...</p>
        </header>

        <section class="meta-card" id="lessonInfo">
            <div>Загрузка информации о занятии...</div>
        </section>

        <section class="photo-upload-section" id="photoUploadSection" style="display: none;">
            <h3 style="margin-top: 0; margin-bottom: var(--spacing-md); font-family: var(--font-family-mono); text-transform: uppercase; letter-spacing: 1px;">Распознавание лиц</h3>
            <div class="photo-upload-area" id="photoUploadArea">
                <p style="margin: 0; color: var(--text-secondary);">Кликните или перетащите фото сюда</p>
                <p style="margin: var(--spacing-xs) 0 0 0; font-size: var(--font-size-xs); color: var(--text-tertiary);">Поддерживается: JPG, PNG</p>
            </div>
            <input type="file" id="photoFileInput" accept="image/*" style="display: none;">
            <img id="photoPreview" class="photo-preview" alt="Предпросмотр">
            <div class="recognition-stats" id="recognitionStats">
                <strong>Результаты распознавания:</strong>
                <div id="recognitionDetails" style="margin-top: var(--spacing-xs);"></div>
            </div>
            <div style="margin-top: var(--spacing-md);">
                <button class="btn" id="recognizeBtn" style="background: var(--primary); color: var(--text-inverse); display: none;" onclick="performRecognition()">Распознать и отметить</button>
                <button class="btn btn-muted" id="clearPhotoBtn" style="display: none; margin-left: var(--spacing-sm);" onclick="clearPhoto()">Очистить</button>
            </div>
        </section>

        <section id="attendanceBlock">
            <!-- Progress and Bulk Actions Bar -->
            <div style="background: var(--bg-secondary); padding: var(--spacing-md); border-radius: var(--border-radius); margin-bottom: var(--spacing-md); display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-color);">
                <div>
                    <strong style="font-size: var(--font-size-lg); color: var(--text-primary); font-family: var(--font-family-mono);">Прогресс:</strong>
                    <span id="attendanceProgress" style="margin-left: var(--spacing-sm); font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: var(--primary); font-family: var(--font-family-mono);">0 / 0</span>
                    <span style="margin-left: var(--spacing-xs); color: var(--text-secondary); font-size: var(--font-size-sm);">(0%)</span>
                </div>
                <div style="display: flex; gap: var(--spacing-sm);">
                    <button class="btn" onclick="markAllPresent()" style="background: var(--success); color: var(--text-inverse); border-color: var(--success);">
                        Отметить всех присутствующими
                    </button>
                    <button class="btn btn-muted" onclick="clearAllMarks()">
                        Очистить отметки
                    </button>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Студент</th>
                        <th>Группа</th>
                        <th>Статус</th>
                        <th>Оценка (2-5)</th>
                    </tr>
                </thead>
                <tbody id="studentsTable">
                    <tr><td colspan="4">Загрузка списка студентов...</td></tr>
                </tbody>
            </table>
        </section>
    </div>
    <script src="/static/toast.js"></script>
    <script src="/static/attendance.js?v=2"></script>
</body>
</html>

